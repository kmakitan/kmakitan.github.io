<!DOCTYPE html>
<html lang="en">
<style>
body,
html {
    height: 100%;
    width: 100%;
}

#topBar {
    height: 100px;
    width: 100%;
}

#icon {
    display: inline-block;
    padding-left: 50px;
}

#map {
    width: 700px;
    height: 400px;
    background-color: #CCC;
    margin: auto;
}

#barTitle {
    font-size: 40px;
    font-family: 'Century Gothic', CenturyGothic, AppleGothic, sans-serif;
    display: inline-block;
    margin-left: 10px;
}

.controls {
    margin-top: 10px;
    border: 1px solid transparent;
    border-radius: 2px 0 0 2px;
    box-sizing: border-box;
    -moz-box-sizing: border-box;
    height: 32px;
    outline: none;
    box-shadow: 0 2px 6px rgba(0, 0, 0, 0.3);
}

#mapsearch {
    background-color: #fff;
    font-family: Roboto;
    font-size: 15px;
    font-weight: 300;
    margin-left: 12px;
    padding: 0 11px 0 13px;
    text-overflow: ellipsis;
    width: 300px;
}

#mapsearch:focus {
    border-color: #4d90fe;
}
</style>

<head>
    <title>HomeUnion.com</title>
    <link href="http://getbootstrap.com/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="http://getbootstrap.com/examples/jumbotron-narrow/jumbotron-narrow.css" rel="stylesheet">
    <script>
    (function(i, s, o, g, r, a, m) {
        i['GoogleAnalyticsObject'] = r;
        i[r] = i[r] || function() {
            (i[r].q = i[r].q || []).push(arguments)
        }, i[r].l = 1 * new Date();
        a = s.createElement(o),
            m = s.getElementsByTagName(o)[0];
        a.async = 1;
        a.src = g;
        m.parentNode.insertBefore(a, m)
    })(window, document, 'script', 'https://www.google-analytics.com/analytics.js', 'ga');

    ga('create', 'UA-82229468-1', 'auto');
    ga('send', 'pageview');
    </script>
</head>

<body onload="initialize()">
    <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBL4oEzxS33sdotHj8R8jA5d1ATNbGwSfQ&libraries=places" type="text/javascript"></script>
    <div class="container">
        <div class="header">
            <nav>
                <ul class="nav nav-pills pull-right">
                    <li role="presentation" class="active"><a href="#">Home</a></li>
                    <li role="presentation"><a href="/showSignin">Sign In</a></li>
                    <li role="presentation"><a href="/showSignUp">Sign Up</a></li>
                </ul>
            </nav>
            <h3 class="text-muted">HomeUnion.com</h3>
        </div>
        <input type="text" id="mapsearch" size="50">
        <div id="map"></div>
        <script>
        var citymap = {
            UCI: {
                center: {
                    lat: 33.6405,
                    lng: -117.8443
                },
                property: 300,
                title: "UCI"
            },

            SanLuisObispo: {
                center: {
                    lat: 35.2828,
                    lng: -120.6596
                },
                property: 200,
                title: "SLO"
            },

            Davis: {
                center: {
                    lat: 38.5449,
                    lng: -121.7405
                },
                property: 150,
                title: "Davis"
            }
        };
        var sampleMarkerList = [
            [33.6839, -117.7947],
            [33.6844, -117.7952],
            [33.6825, -117.7933],
            [33.6455, -117.8333],
            [33.6405, -117.8443],
            [33.6432, -117.8439],
            [33.6446, -117.8452],
            [33.6732, -117.8376]
        ];
        var markerArray = [];
        var marker;
        var latLong;
        var lat;
        var lng;

        function initialize() {
            var mapDiv = document.getElementById('map');
            var map = new google.maps.Map(mapDiv, {
                center: {
                    lat: 35.2828,
                    lng: -120.6596
                },
                zoom: 6
            });
            var zoomlevel = 6;
            var circleList = [];
            var permCircleList = [];

            var infowindow = new google.maps.InfoWindow();

            //'1Lae-86jeUDLmA6-8APDDqazlTOy1GsTXh28DAkw'
            var layerZ = new google.maps.FusionTablesLayer({
                query: {
                    select: 'geometry',
                    from: '15o5zyWDlyH1hJliDCqeVN2SuWzycxgGt0Y3YBdp2'

                },
                templateId: 2,
                styles: [{
                    polygonOptions: {
                        fillColor: '#00FF00',
                        fillOpacity: 0.1
                    }
                }]
            });

            var layerC = new google.maps.FusionTablesLayer({
                query: {
                    select: 'geometry',
                    from: '1GU44ji_YrtuR_31SS5Urbg775BdGAATCA_GtAKNY'

                },
                templateId: 2,
                styles: [{
                    polygonOptions: {
                        fillColor: '#00FF00',
                        fillOpacity: 0.1
                    }
                }]
            });

            var layerS = new google.maps.FusionTablesLayer({
                query: {
                    select: 'geometry',
                    from: '1rZYZ9TB-Q2fJRs6m0Kzk5XAaJt3gu2uIUW4NXTxM'

                },
                templateId: 2,
                styles: [{
                    polygonOptions: {
                        fillColor: '#00FF00',
                        fillOpacity: 0.1
                    }
                }]
            });
            layerS.setMap(map);

            for (var i = 0; i < sampleMarkerList.length; i++) {
                var marker = new google.maps.Marker({
                    position: {
                        lat: sampleMarkerList[i][0],
                        lng: sampleMarkerList[i][1]
                    },
                });
                markerArray.push(marker);
                google.maps.event.addListener(marker, 'click', (function(marker, i) {
                    return function() {
                        infowindow.setContent(String(Math.round((parseFloat(marker.getPosition().lat()) * 10000)) / 10000) + ", " + String(Math.round((parseFloat(marker.getPosition().lng()) * 10000)) / 10000));
                        infowindow.open(map, marker);
                    }
                })(marker, i));
            }

            var searchBox = new google.maps.places.SearchBox(document.getElementById('mapsearch'));
            map.addListener('bounds_changed', function() {
                searchBox.setBounds(map.getBounds());
            });
            var markers = [];
            searchBox.addListener('places_changed', function() {
                var places = searchBox.getPlaces();
                if (places.length == 0) {
                    return;
                }
                // Clear out the old markers.
                markers.forEach(function(marker) {
                    marker.setMap(null);
                });
                markers = [];
                // For each place, get the icon, name and location.
                var bounds = new google.maps.LatLngBounds();
                places.forEach(function(place) {
                    var icon = {
                        url: place.icon,
                        size: new google.maps.Size(71, 71),
                        origin: new google.maps.Point(0, 0),
                        anchor: new google.maps.Point(17, 34),
                        scaledSize: new google.maps.Size(25, 25)
                    };
                    // Create a marker for each place.
                    markers.push(new google.maps.Marker({
                        map: map,
                        icon: icon,
                        title: place.name,
                        position: place.geometry.location
                    }));
                    if (place.geometry.viewport) {
                        // Only geocodes have viewport.
                        bounds.union(place.geometry.viewport);
                    } else {
                        bounds.extend(place.geometry.location);
                    }
                });
                map.fitBounds(bounds);
            });
            //Display property circles
            function circles() {
                for (var city in citymap) {
                    var cityCircle = new google.maps.Circle({
                            strokeColor: '#FF0000',
                            strokeOpacity: 0.8,
                            strokeWeight: 2,
                            fillColor: '#FF0000',
                            fillOpacity: 0.35,
                            map: map,
                            //citymap[city] is the city object
                            //cityCircle is the circle object
                            center: citymap[city].center,
                            title: citymap[city].title,
                            radius: (citymap[city].property * 10000) / Math.pow(2, zoomlevel)
                        })
                        //store circle objects into list
                    circleList.push([cityCircle, citymap[city].property]);
                    permCircleList.push([cityCircle, citymap[city].property]);
                }
            }

            //circles();
            //listener for changing radius of circle when zoom is changed
            map.addListener('zoom_changed', function() {
                for (var x = 0; x < circleList.length; x++) {
                    circleList[x][0].setMap(null);
                }
                for (var x = 0; x < markerArray.length; x++) {
                    markerArray[x].setMap(null);
                }
                circleList = [];
                zoomlevel = map.getZoom();
                //shows circles when the zoom is between 6 and 12
                if (zoomlevel >= 6 && zoomlevel <= 10) {
                    //circles();
                    for (var i = 0; i < circleList.length; i++) {
                        circleList[i][0].setRadius((circleList[i][1] * 10000) / Math.pow(2, zoomlevel));
                    }
                }

                layerZ.setMap(null);
                layerS.setMap(null);
                layerC.setMap(null);
                if (zoomlevel <= 8) {
                    layerS.setMap(map);
                }
                if (zoomlevel >= 9 && zoomlevel <= 11) {
                    layerC.setMap(map);
                }
                if (zoomlevel >= 12) {
                    layerZ.setMap(map);
                }

                if (zoomlevel > 10) {
                    for (var i = 0; i < markerArray.length; i++) {
                        markerArray[i].setMap(map);
                    }
                }
                //display markers:
            });
            //http://stackoverflow.com/questions/13981960/provide-a-list-of-latitudes-and-longitudes-to-my-google-map-to-visualize-them-wi


            //place marker

            function placeMarker(location) {
                if (marker) {
                    marker.setPosition(location);
                } else {
                    marker = new google.maps.Marker({
                        position: location,
                        map: map
                    });
                }
            }

            //place marker on click listener
            google.maps.event.addListener(map, 'click', function(event) {
                longLat = event.latLng;
                lat = longLat.lat();
                lng = longLat.lng();
                placeMarker(event.latLng);
            });

            // Create the search box and link it to the UI element.



        }
        </script>
        <footer class="footer">
        </footer>
    </div>
</body>

</html>
